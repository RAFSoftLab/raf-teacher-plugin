name: Build and Deploy Plugin

on:
  push:
    branches:
      - main # Pokreće se samo kada pušuješ na main

jobs:
  build:
    runs-on: windows-latest # Koristimo Windows jer koristiš PowerShell i lokalne putanje

    steps:
      # Checkout trenutnog repozitorijuma (plugin)
      - name: Checkout Plugin Repository
        uses: actions/checkout@v3

      # Instaliraj JDK
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: 17
          distribution: temurin

      # Build projekta
      - name: Build with Gradle
        run: ./gradlew build

      # Log za potvrdu da je build uspeo
      - name: Check build folder exists
        run: |
          if (!(Test-Path -Path "build/distributions")) {
            Write-Error "Build folder does not exist!"
          } else {
            Get-ChildItem -Recurse build/distributions
          }

      # Checkout GitHub Pages repozitorijuma (zarko.github.io)
      - name: Checkout GitHub Pages Repository
        uses: actions/checkout@v3
        with:
          repository: zarko-ned/zarko.github.io
          path: gh-pages
          token: ${{ secrets.GITHUB_TOKEN }}

      # Napravi folder i kopiraj fajlove
      - name: Copy plugin zip to GitHub Pages
        run: |
          mkdir -Force gh-pages/nastavnicki
          cp -Recurse build/distributions/* gh-pages/nastavnicki/
        shell: pwsh

      # Komituj i pušuj promene
      - name: Commit and push to GitHub Pages
        run: |
          cd gh-pages
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Deploy nastavnicki plugin - ${{ github.sha }}"
          git push
